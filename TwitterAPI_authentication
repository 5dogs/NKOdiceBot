

function getTwitterService() {
  return OAuth1.createService('twitter')
    // OAuth1.0ã®èªè¨¼ã§åˆ©ç”¨ã™ã‚‹å€¤ã‚’ã‚»ãƒƒãƒˆ
    .setAccessTokenUrl("https://api.twitter.com/oauth/access_token")
    .setRequestTokenUrl("https://api.twitter.com/oauth/request_token")
    .setAuthorizationUrl("https://api.twitter.com/oauth/authorize")
    .setConsumerKey("AAAAAAAAAAAAAAğŸ’©ğŸ’©ï¼AAAAAAAAAAAAA")
    .setConsumerSecret("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB")
    // èªè¨¼å¾Œã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®æŒ‡å®š
    .setCallbackFunction('authCallback')
    // ç”Ÿæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’GASã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¹ãƒˆã‚¢ã«ä¿å­˜ï¼ˆæ°¸ç¶šåŒ–ï¼‰
    .setPropertyStore(PropertiesService.getUserProperties());
}



function generateToken_thenAuthorize() {
  const ui = SpreadsheetApp.getUi();
  const twitterService = getTwitterService();
  if (!twitterService.hasAccess()) {
    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã€èªè¨¼ãƒšãƒ¼ã‚¸ã®URLã‚’è¿”ã—ã¾ã™ã€‚getã—ãŸæƒ…å ±ã‚’ã‚‚ã£ã¦authorize
    const authorizationUrl = twitterService.authorize(); 
    // â‡©â‡©ã‚¤ãƒ©ãƒ³èª¬
    const template = HtmlService.createTemplate('<a href="<?= authorizationUrl ?>" target="_blank">Authorize Link</a>');
    template.authorizationUrl = authorizationUrl;
    // â‡§ã—ã‹ã‚‚ã‚³ãƒ¬é€†èª¬
    ui.showModalDialog(template.evaluate(), 'OAuth1.0èªè¨¼ç”¨ã ã«ã‚‡');
    // â‡§â‡§ã‚¤ãƒ©ãƒ³èª¬
    Logger.log(authorizationUrl +'  <===OAuth1.0èªè¨¼ç”¨ã ã«ã‚‡ãƒ¼ã‚“')
  } else {
    Logger.log("OAuth1.0èªè¨¼ã¯ã™ã§ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã«ã‚‡---")
    Logger.log("ã‚ã¨ui.alertæ¨ã—ã¦ã‚ã’ã¦---")
    ui.alert("OAuth1.0èªè¨¼ã¯ã™ã§ã«è¨±å¯ã•ã‚Œã¦ã„ã‚‹ã«ã‚‡å¤šåˆ†");
  }
}

function authCallback(request) {
  if (getTwitterService().handleCallback(request)) {
    return HtmlService.createHtmlOutput('èªè¨¼ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸã€‚/ authorized!');
  } else {
    return HtmlService.createHtmlOutput('èªè¨¼ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚/ desied( ï¾‰Ğ”`)ï½¼ï½¸ï½¼ï½¸â€¦)');
  }
}

function clearService(){
  OAuth1.createService('twitter')
    .setPropertyStore(PropertiesService.getUserProperties())
    .reset();
}
